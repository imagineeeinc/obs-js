!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).orbsCore={})}(this,(function(e){"use strict";const t="still",s="update",i="mesh",n="customMesh",r="sprite",h="lineRenderer",a=h,o="text",c="texture",l="rect",d="circle",u="plainText",p="down",v="up",m="30px Arial",f={noSupport:"Your browser dose not support canvas"};class y{constructor(e){this.bgColor=e.bgColor,this.canvasId=e.canvasId,this._drawers=this._theDrawers(),this.campos=[0,0],this.lastUpdate=null,this.deltaTime=0}setUpImageCacher(){let e=document.createElement("div");return e.style.display="none",e.id="caveImageCache"+Math.round(Math.floor(9999*Math.random())+1e3),document.body.append(e),e.id}zeroToCenter(e){let t=document.getElementById(this.canvasId);if(!t.getContext)return[!1,f.noSupport];var s=t.getContext("2d");if(!0===e)s.translate(t.width/2,t.height/2);else{if(!1!==e)return[!1,"no given boolen"];s.translate(0,0)}}draw(e,t,s,h,p,v,y,g){null==this.lastUpdate&&(this.lastUpdate=Date.now());let S=Date.now();this.fps=t,this.scene=e.vScene;let w=g()||document.getElementById(this.canvasId);if(!w.getContext)return[!1,f.noSupport];var x=w.getContext("2d",{alpha:!1});x.font=m,x.imageSmoothingEnabled=s,x.fillStyle=this.bgColor,x.clearRect(-50,-50,w.width+100,w.height+100),x.fillRect(-50,-50,w.width+100,w.height+100);let b=[h.x,h.y];b[0]==this.campos[0]&&b[1]==this.campos[1]||(x.translate(b[0]-this.campos[0],b[1]-this.campos[1]),this.campos=b),null==v&&null==v||v(x,{fps:this.fps,screen:w,camera:this.campos});for(var C=0;C<this.scene.length;C++){let e=this.scene[C];if(null!=e.scripts){let t,s=e.scripts;for(var I=0;I<s.length;I++){let i=s[I].importScript||function(){return null},n=s[I].script;i=i(),t=n(e,i,{fps:this.fps,delta:this.deltaTime,screen:w,camera:this.campos,renderer:y}),e=t||e}}if((e.dx||e.dy)&&(e.dx&&(e.x+=e.dx),e.dy&&(e.y+=e.dy)),e.type==i){if(e.drawType==l){this._drawers.rect(x,[e.x-e.width*e.scale/2,e.y-e.height*e.scale/2,e.width*e.scale,e.height*e.scale,e.color])}else if(e.drawType==d){this._drawers.circle(x,[e.x-e.width*e.scale/2,e.y-e.height*e.scale/2,e.width*e.scale,e.color])}}else if(e.type==r){if(e.drawType==c){this._drawers.texture(x,[e.x-e.width*e.scale/2,e.y-e.height*e.scale/2,e.width*e.scale,e.height*e.scale,e.sprite])}}else if(e.type==o){if(e.drawType==u){this._drawers.plainText(x,[e.x-e.width*e.scale/2,e.y-e.height*e.scale/2,e.txt,e.font,e.color])}}else if(e.type==a){this._drawers.lineRndr(x,[e.start,e.end,e.width,e.color])}else if(e.type==n){this._drawers.customMesh(x,e.meshShader,{fps:this.fps,delta:this.deltaTime,screen:w,camera:this.campos,renderer:y},e.meshShader.importScript||function(){return null})}}let T=S-this.lastUpdate;return this.lastUpdate=S,this.deltaTime=T/100,[!0]}_theDrawers(){return{rect:function(e,t){return e.fillStyle=t[4],e.fillRect(t[0],t[1],t[2],t[3]),!0},circle:function(e,t){return e.beginPath(),e.arc(t[0],t[1],t[2],0,2*Math.PI),e.fillStyle=t[3],e.fill(),e.closePath(),!0},texture:function(e,t){return e.drawImage(t[4].img,t[0],t[1],t[2],t[3]),!0},plainText:function(e,t){return e.font=t[3],e.fillStyle=t[4],e.fillText(t[2],t[0],t[1]),!0},lineRndr:function(e,t){return e.strokeStyle=t[3],e.lineWidth=t[2],e.beginPath(),(t[0].isVectObj=!0)?e.moveTo(t[0].x,t[0].y):e.moveTo(t[0][0],t[0][1]),(t[1].isVectObj=!0)?e.lineTo(t[1].x,t[1].y):e.lineTo(t[1][0],t[1][1]),e.stroke(),!0},customMesh:function(e,t,s,i){return(0,t.script)(e,i=i(),s),!0}}}}class g{constructor(){this.vScene=[]}add(e){this.vScene.push(e)}scene(){return this.vScene}moveObj(e,t){this.vScene=function(e,t,s){if(s>=e.length)for(var i=s-e.length+1;i--;)e.push(void 0);return e.splice(s,0,e.splice(t,1)[0]),e}(this.vScene,e,t)}getObj(e){for(var t=0;t<this.vScene.length;t++)if(this.vScene[t].name==e)return this.vScene[t]}exportSelf(){return this}}class S{constructor(e){e.canvas?this.canvas=e.canvas:this.canvas=function(){let e=document.createElement("canvas");return e.id="orbsCanvas"+Math.round(Math.floor(9999*Math.random())+1e3),e.innerHTML="Hmm, Looks like your browser does not support Canvas",e}(),this.antiAliasing=e.antiAliasing||!0,this.canvasId=this.canvas.id,this.canvasObj=e.canvasObj||null,this.events={hoverOver:!1,mouse:{x:0,y:0,primaryBtn:v,drag:!1}},this.imgStore={},this.bgColor=e.bgColor||"#ffffff",this.fps=e.fps||30,this.loop=()=>null,this.renderState=e.renderState||t,this.dynamicCamera=e.dynamicCamera||!1,this.cameraPos=e.camPos||{x:0,y:0},this.shader=null,this.renderState==t?this.updater=!1:this.renderState==s?this.updater=!0:console.error("no proper given renderState.\noptions:( update | still )"),this.scene=e.scene||new g,this.cave=new y({bgColor:this.bgColor,canvasId:this.canvasId}),1==e.disableImageCache||(this.storeId=this.cave.setUpImageCacher())}startRenderCycle(){let e=this.cave;setInterval((()=>function(e,t,s,i,n,r,h,a,o,c,l,d){if(!0===n){s({fps:r,screen:document.getElementById(c),camera:o});let n=e.draw(i,r,h,o,a,l,d,t);!1===n[0]&&(alert(n[1]),console.alert(n[1]))}}(e,this.canvasObj,this.loop,this.scene,this.updater,this.fps,this.antiAliasing,this.imaStore,this.cameraPos,this.canvasId,this.shader,this)),1e3/this.fps)}zeroToCenter(e){this.cave.zeroToCenter(e)}attachCanvas(e){this.canvas=e,this.canvasId=this.canvas.id}addToImgCache(e,t){if(1==e.isImgObj)this.imgStore[t]=e;else{let s=new b(e,t);this.imgStore[t]=s}}setRenderState(e){this.renderState=e||t,this.renderState==t?this.updater=!1:this.renderState==s?this.updater=!0:console.error("no proper given renderState.\noptions:( update | still )")}setSize(e,t){this.canvas.width=e,this.canvas.height=t}setBgColor(e){this.bgColor=e}setScene(e){this.scene=e}draw(e){this.tempScene=e}translateCamera(e){this.cameraPos=e}onLoop(e){this.loop=e}canvasAttactToDom(e,t){"prepend"==t?e.prepend(this.canvas):"append"==t&&e.append(this.canvas),this.canvasObj=()=>document.getElementById(this.canvas.id),document.getElementById(this.canvasId).addEventListener("mouseleave",(e=>{this.events.hoverOver=!0})),document.getElementById(this.canvasId).addEventListener("mousemove",(e=>{this.events.mouse.x=e.offsetX-this.cameraPos.x,this.events.mouse.y=e.offsetY-this.cameraPos.y;for(var t=0;t<this.scene.vScene.length;t++)this.events.mouse.x<this.scene.vScene[t].x+this.scene.vScene[t].width/2&&this.events.mouse.x>this.scene.vScene[t].x-this.scene.vScene[t].width/2&&this.events.mouse.y<this.scene.vScene[t].y+(this.scene.vScene[t].height||this.scene.vScene[t].width/2)&&this.events.mouse.y>this.scene.vScene[t].y-(this.scene.vScene[t].height||this.scene.vScene[t].width/2)?this.scene.vScene[t].events.mouse.hover=!0:this.scene.vScene[t].events.mouse.hover=!1;if(this.events.mouse.primaryBtn==p){this.events.mouse.drag=!0;for(t=0;t<this.scene.vScene.length;t++)this.scene.vScene[t].events.mouse.primaryBtn==p?this.scene.vScene[t].events.mouse.drag=!0:this.scene.vScene[t].events.mouse.drag=!1}else if(this.events.mouse.primaryBtn==v){this.events.mouse.drag=!1;for(t=0;t<this.scene.vScene.length;t++)this.scene.vScene[t].events.mouse.drag=!1}})),document.getElementById(this.canvasId).addEventListener("mousedown",(e=>{this.mouseDown();for(var t=0;t<this.scene.vScene.length;t++)this.events.mouse.x<this.scene.vScene[t].x+this.scene.vScene[t].width/2&&this.events.mouse.x>this.scene.vScene[t].x-this.scene.vScene[t].width/2&&this.events.mouse.y<this.scene.vScene[t].y+(this.scene.vScene[t].height||this.scene.vScene[t].width/2)&&this.events.mouse.y>this.scene.vScene[t].y-(this.scene.vScene[t].height||this.scene.vScene[t].width/2)&&(this.scene.vScene[t].events.mouse.primaryBtn=p)})),document.getElementById(this.canvasId).addEventListener("mouseup",(e=>{this.mouseUp();for(var t=0;t<this.scene.vScene.length;t++)this.scene.vScene[t].events.mouse.primaryBtn=v}))}mouseDown(){this.events.mouse.primaryBtn=p}mouseUp(){this.events.mouse.primaryBtn=v}shaderSet(e){this.shader=e}exportSelf(){return this}}class w{constructor(e){this.script=e||function(){return null}}attachScript(e){this.script=e}imports(e){this.importScript=e}}class x{constructor(e,t,s,i){this.isVectObj=!0,this.x=e||null,this.y=t||null,this.scale=s||null,this.rot=i||null}_giveVector(){return[this.x,this.y,this.scale,this.rot]}}class b{constructor(e,t){this.isImgObj=!0;let s=new Image;s.src=e,this.img=s,this.name=t,this.url=e}}const C={setFullScreenGameCss:function(){document.body.setAttribute("style","padding: 0;\n      margin: 0;\n      height: 100vh")},_:function(){return[new S,new g]},renderer:S,scene:g,obj:class{constructor(e){this.name=e.name||Math.round(Math.floor(9999*Math.random())+1e3),this.type=e.type||i,this.type==i&&(this.drawType=e.drawType),this.drawType=e.drawType||c,this.type!=a&&this.type!=n||(this.drawType=null),this.scripts=[],this.x=e.x||0,this.y=e.y||0,this.width=e.width||0,this.height=e.height||0,this.color=e.color||"#000",this.scale=e.scale||1,this.rotation=e.rotation||0,this.texture=null,e.drawFunc&&this.drawFunc(e.drawFunc),this.events={mouse:{hover:!1,primaryBtn:v,drag:!1}}}_giveCodec(){return{type:this.type,drawType:this.drawType,x:this.x,y:this.y,width:this.width,height:this.height,color:this.color}}attachScript(e){this.scripts.push(e)}setVars(e,t){this[e]=t}drawFunc(e){for(let t=0;t<Object.keys(e).length;t++)this[Object.keys(e)[t]]=e[Object.keys(e)[t]]}move(e){let t=e._giveVector();this.x=this.x+t[0]||this.x,this.y=this.y+t[1]||this.y,this.scale=this.scale+t[2]||this.scale,this.rotation=this.rotation+t[3]||this.rotation}setPos(e){let t=e._giveVector();this.x=t[0]||this.x,this.y=t[1]||this.y,this.scale=t[2]||this.scale,this.rotation=t[3]||this.rotation}},scriptComponent:w,Vector:x,Sprite:b,Image:b,Texture:b};window.onOrbsLoad=()=>null,setTimeout((()=>{window.onOrbsLoad()}),30),e.ORBS=C,e.CaveRenderEngine=y,e.still=t,e.update=s,e.mesh=i,e.customMesh=n,e.canvasShape="mesh",e.sprite=r,e.lineRndr=h,e.line=a,e.text=o,e.texture=c,e.rect=l,e.circle=d,e.paths="paths",e.plainText=u,e.hitbox="hitbox",e.down=p,e.up=v,e.drag="drag",e.defaultFont=m,e.error=f,e.Vect=function(e,t,s,i){return new x(e,t,s,i)},e.newOrbsScriptComponent=w,Object.defineProperty(e,"__esModule",{value:!0})}));
