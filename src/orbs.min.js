const still="still",update="update",mesh="mesh",customMesh="customMesh",canvasShape=mesh,sprite="sprite",lineRndr="lineRenderer",line=lineRndr,text="text",texture="texture",rect="rect",circle="circle",paths="paths",plainText="plainText",hitbox="hitbox",down="down",up="up",drag="drag",defaultFont="30px Arial",error={noSupport:"Your browser dose not support canvas"};function echo(e,t){return console.log(e),console.trace(e)}function array_move(e,t,s){if(s>=e.length)for(var n=s-e.length+1;n--;)e.push(void 0);return e.splice(s,0,e.splice(t,1)[0]),e}function Vect(e,t,s,n){return new Vector(e,t,s,n)}class CaveRenderEngine{constructor(e){this.bgColor=e.bgColor,this.canvasId=e.canvasId,this._drawers=this._theDrawers(),this.campos=[0,0],this.lastUpdate=null,this.deltaTime=0}setUpImageCacher(){let e=document.createElement("div");return e.style.display="none",e.id="caveImageCache"+Math.round(Math.floor(9999*Math.random())+1e3),document.body.append(e),e.id}zeroToCenter(e){let t=document.getElementById(this.canvasId);if(!t.getContext)return[!1,error.noSupport];var s=t.getContext("2d");if(!0===e)s.translate(t.width/2,t.height/2);else{if(!1!==e)return[!1,"no given boolen"];s.translate(0,0)}}draw(e,t,s,n,i,r,h){null==this.lastUpdate&&(this.lastUpdate=Date.now());let a=Date.now();this.fps=t,this.scene=e.vScene;let o=document.getElementById(this.canvasId);if(!o.getContext)return[!1,error.noSupport];var c=o.getContext("2d",{alpha:!1});c.font=defaultFont,c.imageSmoothingEnabled=s,c.fillStyle=this.bgColor,c.clearRect(-50,-50,o.width+100,o.height+100),c.fillRect(-50,-50,o.width+100,o.height+100);let l=[n.x,n.y];l[0]==this.campos[0]&&l[1]==this.campos[1]||(c.translate(l[0]-this.campos[0],l[1]-this.campos[1]),this.campos=l),null==r&&null==r||r(c,{fps:this.fps,screen:o,camera:this.campos});for(var d=0;d<this.scene.length;d++){let e=this.scene[d];if(null!=e.scripts){let t,s=e.scripts;for(var u=0;u<s.length;u++){let n=s[u].importScript||function(){return null},i=s[u].script;n=n(),t=i(e,n,{fps:this.fps,delta:this.deltaTime,screen:o,camera:this.campos,renderer:h}),e=t||e}}if((e.dx||e.dy)&&(e.dx&&(e.x+=e.dx),e.dy&&(e.y+=e.dy)),e.type==mesh){if(e.drawType==rect){this._drawers.rect(c,[e.x-e.width*e.scale/2,e.y-e.height*e.scale/2,e.width*e.scale,e.height*e.scale,e.color])}else if(e.drawType==circle){this._drawers.circle(c,[e.x-e.width*e.scale/2,e.y-e.height*e.scale/2,e.width*e.scale,e.color])}}else if(e.type==sprite){if(e.drawType==texture){this._drawers.texture(c,[e.x-e.width*e.scale/2,e.y-e.height*e.scale/2,e.width*e.scale,e.height*e.scale,e.sprite])}}else if(e.type==text){if(e.drawType==plainText){this._drawers.plainText(c,[e.x-e.width*e.scale/2,e.y-e.height*e.scale/2,e.txt,e.font,e.color])}}else if(e.type==line){this._drawers.lineRndr(c,[e.start,e.end,e.width,e.color])}else if(e.type==customMesh){this._drawers.customMesh(c,e.meshShader,{fps:this.fps,delta:this.deltaTime,screen:o,camera:this.campos,renderer:h},e.meshShader.importScript||function(){return null})}}let p=a-this.lastUpdate;return this.lastUpdate=a,this.deltaTime=p/100,[!0]}_theDrawers(){return{rect:function(e,t){return e.fillStyle=t[4],e.fillRect(t[0],t[1],t[2],t[3]),!0},circle:function(e,t){return e.beginPath(),e.arc(t[0],t[1],t[2],0,2*Math.PI),e.fillStyle=t[3],e.fill(),e.closePath(),!0},texture:function(e,t){return e.drawImage(t[4].img,t[0],t[1],t[2],t[3]),!0},plainText:function(e,t){return e.font=t[3],e.fillStyle=t[4],e.fillText(t[2],t[0],t[1]),!0},lineRndr:function(e,t){return e.strokeStyle=t[3],e.lineWidth=t[2],e.beginPath(),(t[0].isVectObj=!0)?e.moveTo(t[0].x,t[0].y):e.moveTo(t[0][0],t[0][1]),(t[1].isVectObj=!0)?e.lineTo(t[1].x,t[1].y):e.lineTo(t[1][0],t[1][1]),e.stroke(),!0},customMesh:function(e,t,s,n){return(0,t.script)(e,n=n(),s),!0}}}}class newOrbsScene{constructor(){this.vScene=[]}add(e){this.vScene.push(e)}scene(){return this.vScene}moveObj(e,t){this.vScene=array_move(this.vScene,e,t)}getObj(e){for(var t=0;t<this.vScene.length;t++)if(this.vScene[t].name==e)return this.vScene[t]}exportSelf(){return this}}class newOrbsRenderer{constructor(e){e.canvas?this.canvas=e.canvas:this.canvas=function(){let e=document.createElement("canvas");return e.id="orbsCanvas"+Math.round(Math.floor(9999*Math.random())+1e3),e.innerHTML="Hmm, Looks like your browser does not support Canvas",e}(),this.antiAliasing=e.antiAliasing||!0,this.canvasId=this.canvas.id,this.events={hoverOver:!1,mouse:{x:0,y:0,primaryBtn:up,drag:!1}},this.imgStore={},this.bgColor=e.bgColor||"#ffffff",this.fps=e.fps||30,this.loop=()=>null,this.renderState=e.renderState||still,this.dynamicCamera=e.dynamicCamera||!1,this.cameraPos=e.camPos||{x:0,y:0},this.shader=null,this.renderState==still?this.updater=!1:this.renderState==update?this.updater=!0:console.error("no proper given renderState.\noptions:( update | still )"),this.scene=e.scene||new newOrbsScene,this.cave=new CaveRenderEngine({bgColor:this.bgColor,canvasId:this.canvasId}),1==e.disableImageCache||(this.storeId=this.cave.setUpImageCacher())}startRenderCycle(){let e=this.cave;setInterval((()=>function(e,t,s,n,i,r,h,a,o,c,l){if(!0===n){t({fps:i,screen:document.getElementById(o),camera:a});let n=e.draw(s,i,r,a,h,c,l);!1===n[0]&&(alert(n[1]),console.alert(n[1]))}}(e,this.loop,this.scene,this.updater,this.fps,this.antiAliasing,this.imaStore,this.cameraPos,this.canvasId,this.shader,this)),1e3/this.fps)}zeroToCenter(e){this.cave.zeroToCenter(e)}attachCanvas(e){this.canvas=e,this.canvasId=this.canvas.id}addToImgCache(e,t){if(1==e.isImgObj)imgStore[t]=image;else{let s=new newOrbsImage(e,t);this.imgStore[t]=s}}setRenderState(e){this.renderState=e||still,this.renderState==still?this.updater=!1:this.renderState==update?this.updater=!0:console.error("no proper given renderState.\noptions:( update | still )")}setSize(e,t){this.canvas.width=e,this.canvas.height=t}setBgColor(e){this.bgColor=e}setScene(e){this.scene=e}draw(e){this.tempScene=e}translateCamera(e){this.cameraPos=e}onLoop(e){this.loop=e}canvasAttactToDom(e,t){"prepend"==t?e.prepend(this.canvas):"append"==t&&e.append(this.canvas),document.getElementById(this.canvasId).addEventListener("mouseleave",(e=>{this.events.hoverOver=!0})),document.getElementById(this.canvasId).addEventListener("mousemove",(e=>{this.events.mouse.x=e.offsetX-this.cameraPos.x,this.events.mouse.y=e.offsetY-this.cameraPos.y;for(var t=0;t<this.scene.vScene.length;t++)this.events.mouse.x<this.scene.vScene[t].x+this.scene.vScene[t].width/2&&this.events.mouse.x>this.scene.vScene[t].x-this.scene.vScene[t].width/2&&this.events.mouse.y<this.scene.vScene[t].y+(this.scene.vScene[t].height||this.scene.vScene[t].width/2)&&this.events.mouse.y>this.scene.vScene[t].y-(this.scene.vScene[t].height||this.scene.vScene[t].width/2)?this.scene.vScene[t].events.mouse.hover=!0:this.scene.vScene[t].events.mouse.hover=!1;if(this.events.mouse.primaryBtn==down){this.events.mouse.drag=!0;for(t=0;t<this.scene.vScene.length;t++)this.scene.vScene[t].events.mouse.primaryBtn==down?this.scene.vScene[t].events.mouse.drag=!0:this.scene.vScene[t].events.mouse.drag=!1}else if(this.events.mouse.primaryBtn==up){this.events.mouse.drag=!1;for(t=0;t<this.scene.vScene.length;t++)this.scene.vScene[t].events.mouse.drag=!1}})),document.getElementById(this.canvasId).addEventListener("mousedown",(e=>{this.mouseDown();for(var t=0;t<this.scene.vScene.length;t++)this.events.mouse.x<this.scene.vScene[t].x+this.scene.vScene[t].width/2&&this.events.mouse.x>this.scene.vScene[t].x-this.scene.vScene[t].width/2&&this.events.mouse.y<this.scene.vScene[t].y+(this.scene.vScene[t].height||this.scene.vScene[t].width/2)&&this.events.mouse.y>this.scene.vScene[t].y-(this.scene.vScene[t].height||this.scene.vScene[t].width/2)&&(this.scene.vScene[t].events.mouse.primaryBtn=down)})),document.getElementById(this.canvasId).addEventListener("mouseup",(e=>{this.mouseUp();for(var t=0;t<this.scene.vScene.length;t++)this.scene.vScene[t].events.mouse.primaryBtn=up}))}mouseDown(){this.events.mouse.primaryBtn=down}mouseUp(){this.events.mouse.primaryBtn=up}shaderSet(e){this.shader=e}exportSelf(){return this}}class newOrbsObj{constructor(e){this.name=e.name||Math.round(Math.floor(9999*Math.random())+1e3),this.type=e.type||mesh,this.type==mesh&&(this.drawType=e.drawType),this.drawType=e.drawType||texture,this.type!=line&&this.type!=customMesh||(this.drawType=null),this.scripts=[],this.x=e.x||0,this.y=e.y||0,this.width=e.width||0,this.height=e.height||0,this.color=e.color||"#000",this.scale=e.scale||1,this.rotation=e.rotation||0,this.texture=null,e.drawFunc&&this.drawFunc(e.drawFunc),this.events={mouse:{hover:!1,primaryBtn:up,drag:!1}}}_giveCodec(){return{type:this.type,drawType:this.drawType,x:this.x,y:this.y,width:this.width,height:this.height,color:this.color}}attachScript(e){this.scripts.push(e)}setVars(e,t){this[e]=t}drawFunc(e){for(let t=0;t<Object.keys(e).length;t++)this[Object.keys(e)[t]]=e[Object.keys(e)[t]]}move(e){let t=e._giveVector();this.x=this.x+t[0]||this.x,this.y=this.y+t[1]||this.y,this.scale=this.scale+t[2]||this.scale,this.rotation=this.rotation+t[3]||this.rotation}setPos(e){let t=e._giveVector();this.x=t[0]||this.x,this.y=t[1]||this.y,this.scale=t[2]||this.scale,this.rotation=t[3]||this.rotation}}class newOrbsScriptComponent{constructor(e){this.script=e||function(){return null}}attachScript(e){this.script=e}imports(e){this.importScript=e}}class Vector{constructor(e,t,s,n){this.isVectObj=!0,this.x=e||null,this.y=t||null,this.scale=s||null,this.rot=n||null}_giveVector(){return[this.x,this.y,this.scale,this.rot]}}class newOrbsImage{constructor(e,t){this.isImgObj=!0;let s=new Image;s.src=e,this.img=s,this.name=t}}const ORBS={setFullScreenGameCss:function(){document.body.setAttribute("style","padding: 0;\n    margin: 0;\n    height: 100vh")},_:function(){return[new newOrbsRenderer,new newOrbsScene]},renderer:newOrbsRenderer,scene:newOrbsScene,obj:newOrbsObj,scriptComponent:newOrbsScriptComponent,Vector:Vector,Sprite:newOrbsImage,Image:newOrbsImage,Texture:newOrbsImage};window.onOrbsLoad=()=>null,setTimeout((()=>{window.onOrbsLoad()}),30);
